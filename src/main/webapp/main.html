<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>layui在线调试</title>
    <link rel="stylesheet" href="layui/css/layui.css" media="all">
</head>
<body>

<table class="layui-hide" id="video" lay-filter="test"></table>

<script type="text/html" id="barDemo">
    <button data-method="offset" data-type="auto" class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</button>
    <button class="layui-btn layui-btn-xs" lay-event="edit">编辑</button>
    <button class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</button>
</script>

<script type="text/javascript" src="layui/layui.js"></script>
<script type="text/javascript">
    layui.use(['table', 'form', 'layer'], function(){
        var table = layui.table, //表格
            form = layui.form,
            $ = layui.jquery,
            layer = layui.layer

        //执行一个 table 实例
        table.render({
            elem: '#video'
            ,height: 420
            ,url: 'http://localhost:8080/trill/videos/getResult' //数据接口
            ,parseData: function(res){ //res 即为原始返回的数据
                return {
                    "code": res.status, //解析接口状态
                    "msg": res.message, //解析提示文本
                    "count": res.total, //解析数据长度
                    "data": res.data //解析数据列表
                };
            }
            ,title: '用户表'
            ,page: true //开启分页
            ,toolbar: 'default' //开启工具栏，此处显示默认图标，可以自定义模板，详见文档
            ,cols: [
                [ //表头
                {type: 'checkbox', fixed: 'left'}
                ,{field: 'id', title: 'ID', sort:true, fixed: 'left'}
                ,{field: 'nickname', title: '昵称'}
                ,{field: 'videoDesc', title: '视频描述'}
                ,{field: 'videoPath', title: '视频地址'}
                ,{field: 'likeCounts', title: '点赞数', sort:true}
                ,{field: 'createTime', title: '发布时间', sort:true}
                //,{field: 'status', title: '状态'}
                //,{title: '状态2', align: 'center', templet: '#lockDemo'}
                ,{field: 'status', title: '状态'
                    ,templet: function(d) {
                        var vid = d.id;
                        if (d.status == 1) {
                            return '<input type="checkbox" name="status" value='+vid+' lay-skin="switch" lay-text="发布|下线" lay-filter="statusDemo" checked>'
                        } else if (d.status == 0) {
                            return '<input type="checkbox" name="status" value='+vid+' lay-skin="switch" lay-text="发布|下线" lay-filter="statusDemo">'
                        }
                    }
                }
                ,{fixed: 'right', align:'center', toolbar: '#barDemo'}
                ]
            ]
        });

        form.on('switch(statusDemo)', function(obj){
            var ch = obj.elem.checked;
            var newStatus = (ch == true) ? 1 : 0;
            $.ajax({
                type: 'post',
                url: 'http://localhost:8080/trill/videos/updateStatus',
                data: {
                    'vid' : obj.elem.value,
                    'status' : newStatus
                },
                dataType: 'json',
                success: function (res){
                    layer.msg(res.message/*, {}, function (){}*/)
                }
            })
        });
        
    });
</script>
</body>
</html>